<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="pt-br" 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<title>Contabilidade</title>
	<link rel="stylesheet" href="CSS/index.css" />
</h:head>

<h:body>

	<div id="usernome">
		<p:outputLabel value="Usuário: " />
		<p:outputLabel value="#{login.userLogin}" />
	</div>
	
	<div id="usercod">
		<p:outputLabel value="#{login.userId}" />
	</div>
	
	<div id="interface">
		<header id="cabecalho">
			<figure>
				<img src="Imagens/contabilidade.png" />
			</figure>
			<h1>SISTEMA DE CÁLCULO DE PREÇO</h1>
		</header>
		
		<p:outputLabel value="Temas:" style="position: absolute; right: 265px; top:75px"/>
		<p:themeSwitcher value="#{temaBean.tema}" style="position: absolute; right: 80px; top:70px">
			<f:selectItems value="#{temaBean.temas}"/>
		</p:themeSwitcher>
		
		<p:messages id="msg" autoUpdate="true" closable="true">
			<p:ajaxStatus oncomplete="setTimeout(function() { $('.ui-messages').slideUp(); }, 7500)" />
		</p:messages>
		
		<h:form id="form" onkeypress="$(document).on('keypress', 'form', function(event) { return event.keyCode != 13;});">
			<p:commandButton id="vazio" process="@none" global="false" style="display:none;"/> 
			<p:growl id="msgs" showDetail="true" />
			<p:tabView dynamic="true">

<!-- *************INICIAL**************** -->
				
				<p:tab title="Inicial" id="tableInicial">
					
					Fazer um descritivo do funcionamento de cada aba

					<p:commandButton id="btnLogoutIni" value="Sair" action="#{login.logout}"
									style="position: absolute; right: 10px; top:10px"  />
				</p:tab>

<!-- *************PRODUTO / SERVIÇO**************** -->
				
				<p:tab title="Produto / Serviço" id="tableProduto">
					<p:commandButton id="btnLogoutPS" value="Sair" action="#{login.logout}"
									style="position: absolute; right: 10px; top:10px" />					
					<table id="tabprod">
						<tr>
							<td class="ce"> <p:outputLabel value="Código do Produto: " for="codigo" /> </td>
							<td class="cd"> <p:outputLabel value="Nome do Produto: " for="nome" /> </td>
						</tr>
						<tr>
							<td class="ce"> <p:inputText id="codigo" readonly="#{produto.bloqueiaCampo}" maxlength="10" value="#{produto.codProduto}">
												<p:ajax listener="#{produto.validaCampoCodProdutos}" update="@this btnSalvar"/>
											</p:inputText>	
							</td>
							<td class="cd"> <p:inputText id="nome" maxlength="70" value="#{produto.nomeProduto}" style="width:500px" readonly="#{produto.bloqueiaCampo}">
												<p:ajax listener="#{produto.validaCampoNomeProdutos}" update="@this btnSalvar"/>
											</p:inputText>
							</td>
						</tr>
						<tr>
							<td class="ce"> <p:outputLabel value="Custo: " for="custo" /> </td>
							<td class="cd"> <p:outputLabel value="Tipo: " for="tipo" /> </td>
						</tr>
						<tr>
							<td class="ce"> <p:inputNumber id="custo" maxValue="9999999.99" value="#{produto.custoProduto}" symbol="R$ " emptyValue="sign"/></td>
							<td class="cd"> <p:selectOneMenu id="tipo" value="#{produto.tipoProduto}" style="width:125px" effect="fold">
											<p:messages autoUpdate="true" />
											<f:selectItems value="#{produto.tipoProdutos}" />
											<!-- <f:selectItem itemLabel="Produto" itemValue="Produto" />
											<f:selectItem itemLabel="Serviço" itemValue="Serviço" /> -->
											</p:selectOneMenu> </td>
						</tr>
					</table>
					<br />
					<br />
					<br />
					<center>
						<p:commandButton id="btnSalvar" disabled="#{produto.blockBtn}" value="#{produto.btnName2}" update="@form" actionListener="#{produto.buttonSalvar}" />
						&nbsp;&nbsp;
						<p:commandButton value="#{produto.btnName}" update="@form" actionListener="#{produto.buttonActionCancelar}" />
						<br />
						<br />
						<br />

						<h4>Produtos e Serviços Cadastrados</h4>
						<p:scrollPanel mode="native" style="width:100%; height:200px">
							<p:dataTable var="cadProduto" value="#{produto.listProdutos}">
<!-- 							<p:ajax event="rowSelect" listener="#{produto.onRowSelect}" update=":form:msgs"/> -->
<!-- selectionMode="single" selection="#{produto.selectedProduto}" rowKey="#{cadProduto.codProduto}" update=":form:msgs" -->
								<p:column headerText="Código" style="width:20%">
									<h:outputText value="#{cadProduto.codProduto}" />
								</p:column>

								<p:column headerText="Nome" style="width:50%">
									<h:outputText value="#{cadProduto.nomeProduto}" />
								</p:column>

								<p:column headerText="Custo" style="width:15%">
									<h:outputText value="#{cadProduto.custo}" />
								</p:column>

								<p:column style="width:65px" headerText="Tipo">
									<h:outputText value="#{cadProduto.servico}" />
								</p:column>
								<p:column style="width:95px;text-align: center">
						             <p:commandButton icon="ui-icon-pencil" title="Altera" update="@form" actionListener="#{produto.buttonActionAlterar(cadProduto)}"/>
						             <p:commandButton icon="ui-icon-closethick" title="Deleta" update="@form" actionListener="#{produto.buttonActionExcluir(cadProduto)}">
						             	<p:confirm header="Exclusão do Produto" message="Você tem certeza que deseja excluir este item?" icon="ui-icon-alert" />
						             </p:commandButton>
						        </p:column>
							</p:dataTable>
						</p:scrollPanel>
					</center>
				</p:tab>

<!-- *************FICHA TÉCNICA***************** -->

				<p:tab title="Ficha Técnica" id="ficha">
					<p:commandButton id="btnLogoutFT" value="Sair" ajax="false" action="#{login.logout}"
									style="position: absolute; right: 10px; top:10px" />				
					<table id="tabficha">
						<tr>
							<td class="ce1"> <p:outputLabel value="Nome da Ficha: " for="nomeFicha" /> </td>
							<td class="cd1" colspan="2"> <p:outputLabel value="Nome do Produto: " for="nomeProduto" /> </td>
							
						</tr>
						<tr>
							<td class="ce1"> 
								<p:selectOneMenu id="nomeFicha" value="#{fichaTecnica.nomeFicha}" style="width:380px" effect="fold" editable="true">
								<p:messages autoUpdate="true" />
								<p:ajax listener="#{fichaTecnica.validaFicha}" process="@this" update="fichaTable qtdProduto btnSalvarFicha"/>
<!-- 											<f:selectItem itemLabel="" /> -->
								<f:selectItems value="#{fichaTecnica.nomeFichas}" />
								</p:selectOneMenu> 

							</td>
							<td class="cd1" colspan="2"> 
								<p:selectOneMenu id="nomeProduto" value="#{fichaTecnica.nomeProduto}" style="width:380px" effect="fold" editable="false">
								<p:messages autoUpdate="true" />
								<p:ajax listener="#{fichaTecnica.produtoInfo}" process="@this" update="cusProduto codProduto"/>
<!-- 											<f:selectItem itemLabel="" /> -->
								<f:selectItems value="#{fichaTecnica.nomeProdutoFicha}" />
								</p:selectOneMenu> 
							</td>
						</tr>
						<tr>
 							<td class="ce2"> <p:outputLabel value="Quantidade: " for="qtdProduto" /> </td>
 							<td class="cm2"> <p:outputLabel value="Custo do Produto: " for="cusProduto" /> </td>
 							<td class="cd2"> <p:outputLabel value=" Código do Produto: " for="codProduto" /> </td>
						</tr>
						<tr>
							<td class="ce2"> 
								<p:inputNumber id="qtdProduto" value="#{fichaTecnica.qtdProdutoFicha}" maxValue="9999"/>
							</td>
							<td class="cm2"> <p:inputNumber id="cusProduto" value="#{fichaTecnica.custoProdutoFicha}" readonly="true" symbol="R$ " emptyValue="sign" /> </td>
							<td class="cd2"> <p:inputText id="codProduto" value="#{fichaTecnica.codProdutoFicha}" readonly="true" /> </td>
						</tr>
					</table>
					<br />
					<br />
					<center>
						<p:commandButton id="btnSalvarFicha" value="#{fichaTecnica.btnName}" update="fichaTable btnSalvarFicha nomeFicha qtdProduto" actionListener="#{fichaTecnica.buttonSalvar}" />
						&nbsp;&nbsp;
						<p:commandButton id="btnIncluir"  
										 value="Incluir" actionListener="#{fichaTecnica.buttonIncluir}"
										 update="fichaTable qtdProduto" />
						<br />
						<br />
						<br />

						<h4>Produtos Cadastrados na Ficha (DataTable)</h4>
						<p:scrollPanel mode="native" style="width:100%; height:200px">
							<p:dataTable id="fichaTable" var="cadProdutoFicha" value="#{fichaTecnica.listProdutos}">

								<p:column headerText="Nome Produto" style="width:50%">
									<h:outputText value="#{cadProdutoFicha.nomeProdFicha}" />
								</p:column>

								<p:column headerText="Código Produto" style="width:25%">
									<h:outputText value="#{cadProdutoFicha.codProdFicha}" />
								</p:column>
								<p:column headerText="Qtd" >
									<h:outputText value="#{cadProdutoFicha.qtdProdFicha}" />
								</p:column>

								<p:column headerText="Custo Produto">
									<h:outputText value="#{cadProdutoFicha.custoProdFicha}" />
								</p:column>
								<p:column style="width:95px;text-align: center">
<!-- 						             <p:commandButton icon="ui-icon-pencil" title="Altera" update="@form" /> -->
						             <p:commandButton icon="ui-icon-closethick" title="Deleta" update="fichaTable" actionListener="#{fichaTecnica.buttonExcluir(cadProdutoFicha)}">
						             	<p:confirm header="Exclusão do Produto" message="Você tem certeza que deseja excluir este item?" icon="ui-icon-alert" />
						             </p:commandButton>
						        </p:column>
							</p:dataTable>
						</p:scrollPanel>
					</center>
				</p:tab>


<!-- *************PREÇO FINAL***************** -->

				<p:tab title="Preço Final">
					<p:commandButton id="btnLogoutPF" value="Sair" ajax="false" action="#{login.logout}"
									style="position: absolute; right: 10px; top:10px" />				
					<table id="tabprefinal">
						<tr>
							<td class="ce"> <p:outputLabel value="Nome da Ficha Técnica: " for="fichaTecnica" /> </td>
							<td class="cm"> <p:outputLabel value="Enquadramento Fiscal: " for="fiscal" /> </td>
							<td class="cd"> <p:outputLabel value="Faixa: " for="faixa" /> </td>
							
						</tr>
						<tr>
							<td class="ce">								
								<p:selectOneMenu id="fichaTecnica" value="#{precoFinal.nomeFicha}" style="width:370px" effect="fold" editable="false">
									<p:messages autoUpdate="true" />
									<p:ajax listener="#{precoFinal.getFichaInfo}" process="@this" update="custoFinal preco"/>
	<!-- 								<f:selectItem itemLabel="" /> -->
	
	 								<f:selectItems value="#{fichaTecnica.nomeFichas}" />
								</p:selectOneMenu>
							</td>

							<td class="cm">						
								<p:selectOneMenu id="fiscal" value="#{precoFinal.tipoFiscal}" style="width:165px" effect="fold" editable="false" >
								<p:messages autoUpdate="true" />
								<p:ajax listener="#{precoFinal.getValor}" process="@this" update="valorImp faixa preco"/>
									<f:selectItem itemLabel="Lucro Presumido" itemValue="Presumido" />
									<f:selectItem itemLabel="Simples Nacional" itemValue="Simples" />								
								</p:selectOneMenu>
							</td>	
							<td class="cd">							
								<p:selectOneMenu id="faixa" style="width:250px" value="#{precoFinal.faixa}" effect="fold" editable="false" >
									<p:messages autoUpdate="true" />
									<p:ajax listener="#{precoFinal.getValor}" process="@this" update="valorImp preco"/>
									<f:selectItems value="#{precoFinal.faixas}" />
<!-- 									<f:selectItem itemLabel="" itemValue="" /> -->
<!-- 									<f:selectItem itemLabel="Até 180.000,00" itemValue="6" /> -->
<!-- 									<f:selectItem itemLabel="De 180.000,01 até 360.000,00" itemValue="8.21" /> -->
<!-- 									<f:selectItem itemLabel="De 360.000,01 até 540.000,00" itemValue="10.26" /> -->
<!-- 									<f:selectItem itemLabel="De 540.000,01 até 720.000,00" itemValue="11.31" /> -->
								</p:selectOneMenu>
							</td>	
				
						</tr>
						<tr> <td> <br /> </td> </tr>
						<tr>						
							<td class="ce"> <p:outputLabel value="Valor: " for="valorImp" /> </td>
							<td class="cd"> <p:outputLabel value="Custo: " for="custoFinal" /> </td>
						</tr>
						<tr>
							<td class="ce"> <p:inputNumber id="valorImp" value="#{precoFinal.valorImpo}" symbol="%" emptyValue="sign" symbolPosition="s" readonly="true"/> </td>
							<td class="ce"> 
								<p:inputNumber id="custoFinal" value="#{precoFinal.custoProdutoFicha}" symbol="R$ " emptyValue="sign"  readonly="true"/>
							</td>
						</tr>
						<tr> <td> <br /> </td> </tr>
						<tr>							
							<td class="cm"> <p:outputLabel value="Lucro (%): " for="lucro" /> </td>
							<td class="cd"> <p:outputLabel value="Preço do Produto: " for="preco" /> </td>
						</tr>
						<tr>
							
							<td class="cm"> 
							<p:inputNumber maxValue="9999.99" id="lucro" value="#{precoFinal.percent}" symbol="%" emptyValue="0.00" symbolPosition="s">
								<p:ajax listener="#{precoFinal.calculaPrecoProduto}" process="@this" update="preco"/>
<!-- 												validatorMessage="Custo deve ser maior que zero(0)" -->
<!-- 												<f:validateDoubleRange minimum="0.01"/> -->
<!-- 												<f:ajax event="blur"/> -->
											</p:inputNumber>
							</td>
							<td class="cd"> <p:inputNumber id="preco" value="#{precoFinal.custoTotalFT}" symbol="R$ " emptyValue="sign" readonly="true" /></td>
						</tr>
					</table>
					<br />
					<br />
					<center>
						<p:commandButton value="Calcular"  actionListener="#{precoFinal.buttonSalvarCustoFicha}" />
					</center>
				</p:tab>

<!-- *************USUÁRIO***************** -->

				<p:tab title="Usuário" disabled="#{inicial.permissao ? false : true}">
					<p:commandButton id="btnLogoutUsu" value="Sair" ajax="false" action="#{login.logout}"
									style="position: absolute; right: 10px; top:10px" />				
					<table id="tabuser">
						<tr>
							<td class="ce"> <p:outputLabel value="Nome do Usuário: " for="nomeUser" /> </td>
							<td class="cd"> <p:outputLabel value="Login do Usuário: " for="login" /> </td>
						</tr>
						<tr>
							<td class="ce"> <p:inputText id="nomeUser" value="#{usuario.nomeUsuario}" maxlength="70" style="width:300px"/>	</td>
							<td class="cd"> <p:inputText readonly="#{usuario.bloqueiacampo}" id="login" value="#{usuario.loginUsuario}" maxlength="20" style="width:300px"/></td>
						</tr>
						<tr>
							<td class="ce"> <h:outputText value="Senha: " for="senha" /> </td>
							<td class="cd"> <p:outputLabel value="Perfil do Usuário: " for="console" /> </td>
						</tr>
						<tr>
							<td class="ce"> <p:password id="senha" maxlength="20" feedback="true" style="width:300px" 
											value="#{usuario.senhaUsuario}" redisplay="true">
											<f:ajax event="blur"/>
											</p:password>
							</td>
							<td class="cd"> 
								<p:selectOneMenu id="console" value="#{usuario.tipoUsuario}" style="width:150px" effect="fold">
								<p:messages autoUpdate="true" />
								<f:selectItem itemLabel="Usuário" itemValue="Usuario" />
								<f:selectItem itemLabel="Administrador" itemValue="Administrador" />
								</p:selectOneMenu> </td>
						</tr>
					</table>
					<br />
					<br />
					<center>
						<p:commandButton value="#{usuario.btnName}" update="@form" actionListener="#{usuario.buttonSalvar}" />
						&nbsp;&nbsp;
						<p:commandButton value="#{usuario.btnName2}" update="@form" actionListener="#{usuario.buttonZerar}"/>
						<br />
						<br />
						<br />

						<h4>Usuario Cadastrados</h4>
						<p:scrollPanel mode="native" style="width:100%; height:200px">
							<p:dataTable var="cadUsuario" value="#{usuario.listUsuarios}">
								<p:column headerText="Nome" style="width:50%">
									<h:outputText value="#{cadUsuario.nomeUser}" />
								</p:column>

								<p:column headerText="Login" style="width:30%">
									<h:outputText value="#{cadUsuario.login}" />
								</p:column>

								<p:column headerText="Senha" style="width:30%">
									<h:outputText value="#{cadUsuario.senha}" />
								</p:column>

								<p:column style="width:30%" headerText="Tipo">
									<h:outputText value="#{cadUsuario.permissao}" />
								</p:column>
								<p:column style="width:30%" headerText="Status">
									<h:outputText value="#{cadUsuario.status}" />
								</p:column>
								<p:column style="width:95px;text-align: center">
						             <p:commandButton icon="ui-icon-pencil" title="Altera" update="@form" actionListener="#{usuario.buttonAlterar(cadUsuario)}"/>
						             <p:commandButton icon="#{((cadUsuario.status.equals('Desativado')) ? 'ui-icon-plusthick': 'ui-icon-minusthick')}" title="Ação" update="@form" actionListener="#{usuario.buttonDesativar(cadUsuario)}">
						             	<p:confirm header="Desativar Usuário" message="Você tem certeza que deseja alterar o status do usuário?" icon="ui-icon-alert" />
						             </p:commandButton>
						        </p:column>
							</p:dataTable>
						</p:scrollPanel>
					</center>
				</p:tab>
			</p:tabView>
			<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
		        <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
		        <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
		    </p:confirmDialog>
		</h:form>
		<h6>
			Criado por: Jean Pierre dos Santos /
			José Renato de Souza /
			Marcio Dantas Martinenghi /
			Vinicius Antônio Cavaco
			<br />
			Curso: Sistemas de Informação
			<br />
			Fase: 5ª
		</h6>
	</div>
</h:body>
</html>